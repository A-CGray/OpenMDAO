
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script type="text/javascript">
    <tabulator_src>
</script>
<script type="text/javascript">
        <d3_src>
</script>
<style>
    .unitnomatch {
        color: red;
        font-weight: bold;
    }

    .promoted {
        color: blue;
    }

    .middle {
        text-align: center;
        width: 100%;
        display:table;
    }

    .toggle {
        width: 5%;
        display:table-cell;
        text-align: center;
    }

    input {
        margin: 3px 5px 3px 5px;
    }


    <tabulator_style>
</style>
<title>Scaling Viewer</title>
</head>
<body>
    <h2 id="scaling_title"></h2>
    <div id="dv-table"></div>
    <div id="con-table"></div>
    <div id="obj-table"></div>
    <div id="norm-jac"></div>
<script type="text/javascript">

var data = <scaling_data>;
var dv_tabledata = data.dv_table;
var con_tabledata = data.con_table;
var obj_tabledata = data.obj_table;
var jac_data = data.matrix;
var jac_norm_data = data.norm_matrix;

document.title = data.title;
document.getElementById("scaling_title").innerHTML = data.title


var dvtable =
    new Tabulator("#dv-table", {
        // set height of table (in CSS or here), this enables the Virtual DOM and
        // improves render speed dramatically (can be any valid css height value)
        // height: 650,
        title: "foo",
        data:dv_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        footerElement:"<p class='middle'>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"units\")'>units</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"size\")'>size</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"scaled_val\")'>scaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"unscaled_val\")'>unscaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"ref\")'>ref</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"ref0\")'>ref0</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"scaler\")'>scaler</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"adder\")'>adder</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"scaled_upper\")'>scaled upper</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"unscaled_upper\")'>unscaled upper</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"scaled_lower\")'>scaled lower</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"unscaled_lower\")'>unscaled lower</input></span>" +
                            "</p>",
        columns:[ //Define Table Columns
          {
              title: "Design Variables",
              columns: [
                {title: "name", field:"name", align:"left", headerFilter:false, visible:true,},
                {title: "units", field:"units", align:"center", headerFilter:false, visible:true,},
                {title: "size", field:"size", align:"center", headerFilter:false, visible:true,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
                {title: "upper (scaled)", field:"scaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "upper (unscaled)", field:"unscaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "lower (scaled)", field:"scaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "lower (unscaled)", field:"unscaled_lower", align:"right", visible:true, headerFilter:false,},
              ],
          },
        ],
    });


var contable =
    new Tabulator("#con-table", {
        // set height of table (in CSS or here), this enables the Virtual DOM and
        // improves render speed dramatically (can be any valid css height value)
        // height: 650,
        title: "foo",
        data:con_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        footerElement:"<p class='middle'>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"units\")'>units</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"size\")'>size</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"scaled_val\")'>scaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"unscaled_val\")'>unscaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"ref\")'>ref</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"ref0\")'>ref0</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"scaler\")'>scaler</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"adder\")'>adder</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"scaled_upper\")'>scaled upper</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"unscaled_upper\")'>unscaled upper</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"scaled_lower\")'>scaled lower</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"unscaled_lower\")'>unscaled lower</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"scaled_equals\")'>scaled equals</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(contable, \"unscaled_equals\")'>unscaled equals</input></span>" +
                            "</p>",
        // could use a row formatter to make row a color instead of adding another column for 'linear'
        // rowFormatter:function(row){
        //     var pos = row.getPosition(false);
        //     if (con_tabledata[pos]["linear"]){
        //         row.getElement().style.backgroundColor = "#A6A6DF"; //apply css change to row element
        //     }
        // },
        columns:[ //Define Table Columns
          {
                title: "Constraints",
              columns: [
                {title: "name", field:"name", align:"left", headerFilter:false, visible:true,},
                {title: "units", field:"units", align:"center", headerFilter:false, visible:true,},
                {title: "size", field:"size", align:"center", headerFilter:false, visible:true,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
                {title: "upper (scaled)", field:"scaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "upper (unscaled)", field:"unscaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "lower (scaled)", field:"scaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "lower (unscaled)", field:"unscaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "equals (scaled)", field:"scaled_equals", align:"right", visible:true, headerFilter:false,},
                {title: "equals (unscaled)", field:"unscaled_equals", align:"right", visible:true, headerFilter:false,},
                {title: "linear", field:"linear", align:"center", visible:true, formatter:"tickCross",
                formatterParams: {
                    crossElement: false,  // gets rid of 'x' elements so only check marks show
                }, headerFilter:false,},
              ],
          },
        ],
    });


var objtable =
    new Tabulator("#obj-table", {
                // set height of table (in CSS or here), this enables the Virtual DOM and
                // improves render speed dramatically (can be any valid css height value)
                // height: 650,
                title: "foo",
        data:obj_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        footerElement:"<p class='middle'>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"units\")'>units</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"size\")'>size</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"scaled_val\")'>scaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"unscaled_val\")'>unscaled value</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"ref\")'>ref</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"ref0\")'>ref0</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"scaler\")'>scaler</input></span>" +
                            "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(objtable, \"adder\")'>adder</input></span>" +
                            "</p>",
        columns:[ //Define Table Columns
          {
                title: "Objectives",
              columns: [
                {title: "name", field:"name", align:"left", headerFilter:false, visible:true,},
                {title: "units", field:"units", align:"center", headerFilter:false, visible:true,},
                {title: "size", field:"size", align:"center", headerFilter:false, visible:true,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
              ],
          },
        ],
    });


function col_toggle(tbl, name) {
    tbl.toggleColumn(name);
    tbl.redraw();
}


        // Labels of row and columns
        var gnames = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"]
            var base = "sdfgakjsyegfasekyfgasejfygasefjy"
            var gbase = "fygasefjy"
        var vnames = ["v1", "v2", "v3", "v4", "v5", "v6", "v7", "v8", "v9", "v10"]
        var myVars = vnames.map(function (v, i, arr) {
            return base + v;
        });
        var myGroups = gnames.map(function(v, i, arr) {
            return gbase + v;
        });

        var viewport_width = document.documentElement.clientWidth * .95;
        var viewport_height = document.documentElement.clientHeight * .75;

        var leftmargin = d3.max(myVars, s => s.length) * 5;
        var bottommargin = d3.max(myGroups, s => s.length) * 6;

        // set the dimensions and margins of the graph
        var margin = {top: 30, right: 30, bottom: bottommargin, left: leftmargin },
            width = viewport_width - margin.left - margin.right,
            height = viewport_height - margin.top - margin.bottom;

        var w = width + margin.left + margin.right;
        var h = height + margin.top + margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#norm-jac")
            .append("svg")
            .attr("viewBox", "0 0 " + w + " " + h)
            .attr("preserveAspectRatio", "xMidYMid meet")
        .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Build X scales and axis:
        var x = d3.scaleBand()
            .range([0, width])
            .domain(myGroups)
            .padding(0.01);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "start")
                .attr("dx", ".8em")
                .attr("dy", "-.5em")
                .attr("transform", "rotate(90)");

        // Build Y scales and axis:
        var y = d3.scaleBand()
            .range([height, 0])
            .domain(myVars)
            .padding(0.01);
        svg.append("g")
            .call(d3.axisLeft(y));

        // Build color scale
        var myColor = d3.scaleLinear()
            .range(["white", "#69b3a2"])
            .domain([1, 100])

        var array = [];
        for (i = 0; i < myVars.length; i++) {
            for (j = 0; j < myGroups.length; j ++) {
                    array.push({ 'value': i * j, 'group': myGroups[j], 'variable': myVars[i] });
            }
        }

        svg.selectAll()
            .data(array, function (d) { return d.group + ':' + d.variable; })
            .enter()
            .append("rect")
            .attr("x", function (d) { return x(d.group) })
            .attr("y", function (d) { return y(d.variable) })
            .attr("width", x.bandwidth())
            .attr("height", y.bandwidth())
            .style("fill", function (d) { return myColor(d.value) })

// data format for adjacency matrix
// {
//     "nodes": [
//         {"id": "Bob", "group": 3},
//         ...
//     ],
//     'links': [
//             {"source": "Napoleon", "target": "Myriel", "value": 1},
//             ...
//     ]
// }

</script>
</body>
</html>
