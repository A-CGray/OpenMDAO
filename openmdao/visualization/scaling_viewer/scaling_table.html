
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<script type="text/javascript">
    <tabulator_src>
</script>
<script type="text/javascript">
        <d3_src>
</script>
<script>
    var data = <scaling_data>;
</script>
<style>
    <tabulator_style>
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 120px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }
</style>
</head>
<body>
    <h1 id="scaling_title"></h1>
    <h2>Design Variables</h2>
    <div id="dv-table"></div>
    <h2>Constraints</h2>
    <div id="con-table"></div>
    <h2>Objectives</h2>
    <div id="obj-table"></div>
    <div id="norm-jac"></div>
<script type="text/javascript">

var dv_tabledata = data.dv_table;
var con_tabledata = data.con_table;
var obj_tabledata = data.obj_table;
var jac_data = data.matrix;
var jac_norm_data = data.norm_matrix;
var wrtVars = data.wrtlabels;
var ofVars = data.oflabels;


document.title = data.title;
document.getElementById("scaling_title").innerHTML = data.title


var dvtable =
    new Tabulator("#dv-table", {
        // set height of table (in CSS or here), this enables the Virtual DOM and
        // improves render speed dramatically (can be any valid css height value)
        // height: 650,
        title: "foo",
        data:dv_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        // footerElement:"<p class='middle'>" +
        //                     "<span class='toggle'><input type='checkbox' checked='true' onclick='col_toggle(dvtable, \"units\")'>units</input></span>" +
        //                     "</p>",
        columns:[ //Define Table Columns
          {
              title: "Design Variables",
              columns: [
                {title: "name", field:"name", align:"left", headerFilter:false, visible:true,},
                {title: "units", field:"units", align:"center", headerFilter:false, visible:true,},
                {title: "size", field:"size", align:"center", headerFilter:false, visible:true,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
                {title: "upper (scaled)", field:"scaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "upper (unscaled)", field:"unscaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "lower (scaled)", field:"scaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "lower (unscaled)", field:"unscaled_lower", align:"right", visible:true, headerFilter:false,},
              ],
          },
        ],
    });


var contable =
    new Tabulator("#con-table", {
        // set height of table (in CSS or here), this enables the Virtual DOM and
        // improves render speed dramatically (can be any valid css height value)
        // height: 650,
        title: "foo",
        data:con_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        // could use a row formatter to make row a color instead of adding another column for 'linear'
        // rowFormatter:function(row){
        //     var pos = row.getPosition(false);
        //     if (con_tabledata[pos]["linear"]){
        //         row.getElement().style.backgroundColor = "#A6A6DF"; //apply css change to row element
        //     }
        // },
        columns:[ //Define Table Columns
          {
              title: "Constraints",
              columns: [
                {title: "name", field:"name", align:"left", headerFilter:false, visible:true,},
                {title: "units", field:"units", align:"center", headerFilter:false, visible:true,},
                {title: "size", field:"size", align:"center", headerFilter:false, visible:true,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
                {title: "upper (scaled)", field:"scaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "upper (unscaled)", field:"unscaled_upper", align:"right", visible:true, headerFilter:false,},
                {title: "lower (scaled)", field:"scaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "lower (unscaled)", field:"unscaled_lower", align:"right", visible:true, headerFilter:false,},
                {title: "equals (scaled)", field:"scaled_equals", align:"right", visible:true, headerFilter:false,},
                {title: "equals (unscaled)", field:"unscaled_equals", align:"right", visible:true, headerFilter:false,},
                {title: "linear", field:"linear", align:"center", visible:true, formatter:"tickCross",
                formatterParams: {
                    crossElement: false,  // gets rid of 'x' elements so only check marks show
                }, headerFilter:false,},
              ],
          },
        ],
    });


var objtable =
    new Tabulator("#obj-table", {
        // set height of table (in CSS or here), this enables the Virtual DOM and
        // improves render speed dramatically (can be any valid css height value)
        // height: 650,
        title: "foo",
        data:obj_tabledata, //assign data to table
        layout:"fitColumns", //"fitDataFill",
        columns:[ //Define Table Columns
          {
                title: "Objectives",
              columns: [
                {title: "name", field:"name", align:"left", visible:true, headerFilter:false,},
                {title: "units", field:"units", align:"center", visible:true, headerFilter:false,},
                {title: "size", field:"size", align:"center", visible:true, headerFilter:false,},
                {title: "value (scaled)", field:"scaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "value (unscaled)", field:"unscaled_val", align:"right", visible:true, headerFilter:false,},
                {title: "ref", field:"ref", align:"right", visible:true, headerFilter:false,},
                {title: "ref0", field:"ref0", align:"right", visible:true, headerFilter:false,},
                {title: "scaler", field:"scaler", align:"right", visible:true, headerFilter:false,},
                {title: "adder", field:"adder", align:"right", visible:true, headerFilter:false,},
              ],
          },
        ],
    });


function col_toggle(tbl, name) {
    tbl.toggleColumn(name);
    tbl.redraw();
}


        var viewport_width = document.documentElement.clientWidth * .95;
        var viewport_height = document.documentElement.clientHeight * .75;

        var leftmargin = d3.max(ofVars, s => s.length) * 5.5;
        var bottommargin = d3.max(wrtVars, s => s.length) * 6;

        // set the dimensions and margins of the graph
        var margin = {top: 30, right: 30, bottom: bottommargin, left: leftmargin },
            width = viewport_width - margin.left - margin.right,
            height = viewport_height - margin.top - margin.bottom;

        var w = width + margin.left + margin.right;
        var h = height + margin.top + margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select("#norm-jac")
            .append("svg")
            .attr("viewBox", "0 0 " + w + " " + h)
            .attr("preserveAspectRatio", "xMidYMid meet")
        .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        // Build X scales and axis:
        var x = d3.scaleBand()
            .range([0, width])
            .domain(wrtVars)
            .padding(0.01);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
                .selectAll("text")
                .style("text-anchor", "start")
                .attr("dx", ".8em")
                .attr("dy", "-.5em")
                .attr("transform", "rotate(90)");

        // Build Y scales and axis:
        var y = d3.scaleBand()
            .range([0, height])
            .domain(ofVars)
            .padding(0.01);
        svg.append("g")
            .call(d3.axisLeft(y));

        // create a tooltip
        var tooltip = d3.select("#norm-jac")
            .append("div")
            .style("opacity", 0)
            .attr("class", "tooltip")
            // .style("background-color", "white")
            // .style("border", "solid")
            // .style("border-width", "2px")
            // .style("border-radius", "5px")
            .style("padding", "5px");

        var mouseover = function(event, d) {
            event.stopPropagation();
            tooltip.style("opacity", 1);
            d3.select(this)
                .style("stroke", "black")
                .style("opacity", 1);
        }

        var mousemove = function(event, d) {
            event.stopPropagation();
            tooltip
                .html(d.value)
                .style("left", event.pageX + 70 + "px")
                .style("top", event.pageY + "px");
        }

        var mouseleave = function(event, d) {
            event.stopPropagation();
            tooltip.style("opacity", 0)
            d3.select(this)
                .style("stroke", "none")
                .style("opacity", 0.8);
        }

        var array = [];
        for (i = 0; i < ofVars.length; i++) {
            for (j = 0; j < wrtVars.length; j ++) {
                    array.push({ 'value': jac_norm_data[i][j], 'group': wrtVars[j], 'variable': ofVars[i] });
            }
        }

        var maxcolor = Math.abs(d3.max(array, s => s.value));

        // Build color scale
        var myColor = d3.scaleDiverging()
            .interpolator(d3.interpolateRdYlBu)
            .domain([-maxcolor, 0, maxcolor]);

        svg.selectAll()
            .data(array, function (d) { return d.group + ':' + d.variable; })
            .enter()
            .append("rect")
            .attr("x", function (d) { return x(d.group) })
            .attr("y", function (d) { return y(d.variable) })
            .attr("width", x.bandwidth())
            .attr("height", y.bandwidth())
            .style("fill", function (d) { return myColor(d.value) })
            .on("mouseover", mouseover)
            .on("mousemove", mousemove)
            .on("mouseleave", mouseleave);

</script>
</body>
</html>
